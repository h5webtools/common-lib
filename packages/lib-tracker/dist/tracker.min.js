!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Tracker=e()}(this,function(){"use strict";function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],o=window.onerror;window.onerror=function(){var i=Array.prototype.slice.call(arguments);o&&o.apply(window,i);var r=e.apply(window,i);return r.msg.indexOf("Script error")>-1&&!r.url?(t.debug&&console.log(r.msg),!1):(n&&n(r),!1)}}function e(t,e,n,o,i){var r="";return e=e||i&&i.fileName||"",n=n||i&&i.lineNumber||"",o=o||i&&i.columnNumber||"",r=i&&i.stack||"",{msg:t,url:e,line:n,col:o,stack:r}}function n(t,e,n){if(t+="",(e-=t.length)<=0)return t;if(n||0===n||(n=" ")," "===(n+="")&&e<10)return m[e]+t;for(var o="";;){if(1&e&&(o+=n),!(e>>=1))break;n+=n}return o+t}function o(t){var e=arguments[1]||window.location.search.replace("&amp;","&"),n=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),o=e.substr(e.indexOf("?")+1).match(n);return null!=o?o[2]:""}function i(t){var e=new RegExp("(^| )"+t+"(?:=([^;]*))?(;|$)"),n=document.cookie.match(e);return n?n[2]?unescape(n[2]):"":null}function r(){var t="";return f.android?t="android":f.ios&&(t="ios"),t}function a(t){return t=t||"g_tracker",String(Math.random()+Math.random()).replace(v,t)}function s(){return y||(f.jyb&&"undefined"!=typeof wv?wv.ready(function(){wv.getNetworkType({complete:function(t){y=t.networkType}})}):navigator.connection&&(y=navigator.connection.type||""),y||"")}function u(t){switch(Object.prototype.toString.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return t instanceof Error}}function c(){var t=new Date;return t.getFullYear()+"-"+n(t.getMonth()+1,2,"0")+"-"+n(t.getDate(),2,"0")+" "+n(t.getHours(),2,"0")+":"+n(t.getMinutes(),2,"0")+":"+n(t.getSeconds(),2,"0")}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={link:location.href,ua:navigator.userAgent,title:document.title,size:document.documentElement.clientWidth+"*"+document.documentElement.clientHeight,referer:document.referer||"",timestamp:(new Date).getTime(),network:s(),badjs:_.BAD_JS,pid:t.pid},i=E(n,e),a=j[t.env]||"",u={ak:O,body:JSON.stringify({cmd:x,data:[{sid:"",op_type:"error",op_result:"",op_time:c(),op_object:"",op_page:"",op_params:E({platform:r(),in_app:f.jyb?1:0,cust_id:T,uniq_id:T||S,source:o("channel")||o("from")||"",act_id:"",group:""},i)}]})},d=[];for(var p in u)d.push(p+"="+encodeURIComponent(u[p]));t.debug?console.log(JSON.stringify(i,null,2)):l(a+"?"+d.join("&"))}function l(t){var e=a(),n=new Image;window[e]||(window[e]=n,n.onload=n.onerror=function(){window[e]=null,delete window[e]}),n.src=t}function p(t,e){if(!t)return"";var n=t.toString(),o=n.split("\n");return o.length>e?o.slice(0,e).join("\n"):n}function h(t){var e=["method","url","body","time","statusCode","statusText","result"];return e.forEach(function(e){void 0===t[e]&&(t[e]="")}),t.c1=["method","url","body"].map(function(e){return e+":"+t[e]}).join(";"),t.c2=["time","statusCode","statusText"].map(function(e){return e+":"+t[e]}).join(";"),t.c3=t.result,e.forEach(function(e){return delete t[e]}),t}var f=function(t){var e=t.match(/(Android);?[\s\/]+([\d.]+)?/),n=t.match(/(iPad).*OS\s([\d_]+)/),o=t.match(/(iPod)(.*OS\s([\d_]+))?/),i=!n&&t.match(/(iPhone\sOS)\s([\d_]+)/),r=/jiayoubao/.test(t.toLowerCase()),a={};return a.jyb=r,a.ie="ActiveXObject"in window,e&&(a.android=!0,a.version=e[2]),i&&!o&&(a.ios=a.iphone=!0,a.version=i[2].replace(/_/g,".")),n&&(a.ios=a.ipad=!0,a.version=n[2].replace(/_/g,".")),o&&(a.ios=a.ipod=!0,a.version=o[3]?o[3].replace(/_/g,"."):null),a}(window.navigator.userAgent),m=[""," ","  ","   ","    ","     ","      ","       ","        ","         "],v=/\d\.\d{4}/,g="__TRACKER_UUID__",y="";s();var w={JS_ERROR:"1",API_ERROR:"2"},_={BAD_JS:"1"},b=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},k=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),E=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},j={test:"//172.16.1.16:8890",prod:"//report.jyblife.com"},O="KVQiUTJf",x="65010000",T=o("userid")||i("userid")||"",S=function(){try{var t=window.localStorage.getItem(g);return t||(t=a(),window.localStorage.setItem(g,t)),t}catch(t){return a()}}(),A=function(){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b(this,n),this.$options=t,this.params=E({t_type:w.JS_ERROR},e),this._init()}return k(n,[{key:"_init",value:function(){var e=this;this.$options.collectWindowErrors&&t(this.$options,function(t){e._send(t)})}},{key:"_send",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(this.$options,this._paramsAdaptor(E({},this.params,t)))}},{key:"_paramsAdaptor",value:function(t){var e=["msg","line","col","url","stack"],n=this.$options;return e.forEach(function(e){t[e]||(t[e]="")}),t.c1=[t.msg,t.line,t.col].join(","),t.c2=t.url,t.c3=p(t.stack,n.stackDepth),e.forEach(function(e){return delete t[e]}),t}},{key:"captureError",value:function(t,n){u(t)&&this._send(E(e((t.name||"")+": "+(t.message||""),"","","",t),n))}}]),n}(),R=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b(this,t),this.$options=e,this.params=E({t_type:w.API_ERROR},n),this._init()}return k(t,[{key:"captureApi",value:function(t){this._send(t,!1)}},{key:"_init",value:function(){this.$options.ajax&&this._ajaxHook(window.XMLHttpRequest)}},{key:"_send",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=E({},this.params,t);e&&(n=h(n)),d(this.$options,n)}},{key:"_ajaxHook",value:function(t){var e=t.prototype.open,n=t.prototype.send,o=this;t.prototype.open=function(t,n){return this._apiTrackData={method:t.toLowerCase(),url:n},e.apply(this,arguments)},t.prototype.send=function(t){return this._apiTrackData.start=Date.now(),this._apiTrackData.body=t?JSON.stringify(t):"",o._addEvent(this),n.apply(this,arguments)}}},{key:"_addEvent",value:function(t){var e=this;t.addEventListener("readystatechange",function(){if(4===t.readyState){var n=t._apiTrackData,o=e.$options.apiCodeList;if(!n)return;var i=Date.now()-n.start,r={method:n.method,url:n.url,body:n.body,time:i,statusCode:t.status,statusText:t.statusText},a=null;if(t.status>=400)return void e._send(E({result:""},r));if(200===t.status)try{if(a=JSON.parse(t.responseText),0===o.length&&0!==a.code&&"0"!==a.code||o.indexOf(a.code)>-1)return void e._send(E({result:t.responseText},r))}catch(t){}i>e.$options.apiThreshold&&e._send(E({result:t.responseText},r))}},!0)}}]),t}(),$={pid:function(){var t=window.location.href,e=t.slice(t.indexOf("://")+3).split(/\/+/);return e.length>2?e[1]:""}(),debug:!1,ajax:!1,apiThreshold:3e3,apiCodeList:[],collectWindowErrors:!0,stackDepth:8,env:"prod",commonParams:null},D=function(){function t(){b(this,t),this.$options={},this.commonParams={},this.inited=!1}return k(t,[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.inited||(this.$options=E({},$,t),this.commonParams=this.$options.commonParams||{},this.initError(),this.initApi(),this.inited=!0)}},{key:"log",value:function(t){if(!this.inited)throw new Error("必须先初始化");d(this.$options,E({},this.commonParams,t))}},{key:"initApi",value:function(){var t=new R(this.$options,this.commonParams);this.api=t,this.Api=t,this.captureApi=t.captureApi.bind(t)}},{key:"initError",value:function(){var t=new A(this.$options,this.commonParams);this.error=t,this.Error=A,this.captureError=t.captureError.bind(t)}}]),t}(),P=new D;return P.Ctor=D,P});
