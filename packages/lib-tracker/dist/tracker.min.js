!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.Tracker=n()}(this,function(){"use strict";function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],t=window.onerror;window.onerror=function(r,o,i,a,c){var s=Array.prototype.slice.call(arguments);if(t&&t.apply(window,s),"Script error."===r||o){a=a||window.event&&window.event.errorCharacter||0;var u="";if(c.stack)u=c.stack;else{for(var l=[],d=arguments.callee.caller,f=3;d&&--f>0&&(l.push(d.toString()),d!==d.caller);)d=d.caller;u=l.join("")}return n&&n({msg:r,url:o,line:i,col:a,errStack:u.toString()}),!e.debug}}}function n(e,n,t){if(e+="",(n-=e.length)<=0)return e;if(t||0===t||(t=" ")," "===(t+="")&&n<10)return y[n]+e;for(var r="";;){if(1&n&&(r+=t),!(n>>=1))break;t+=t}return r+e}function t(e){var n=arguments[1]||window.location.search.replace("&amp;","&"),t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),r=n.substr(n.indexOf("?")+1).match(t);return null!=r?r[2]:""}function r(e){var n=new RegExp("(^| )"+e+"(?:=([^;]*))?(;|$)"),t=document.cookie.match(n);return t?t[2]?unescape(t[2]):"":null}function o(){var e="";return w.android?e="android":w.ios&&(e="ios"),e}function i(e){return e=e||"g_tracker",String(Math.random()+Math.random()).replace(_,e)}function a(){return E||(w.jyb&&"undefined"!=typeof wv?wv.ready(function(){wv.getNetworkType({complete:function(e){E=e.networkType}})}):navigator.connection&&(E=navigator.connection.type||""),E||"")}function c(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}}function s(){var e=new Date;return e.getFullYear()+"-"+n(e.getMonth()+1,2,"0")+"-"+n(e.getDate(),2,"0")+" "+n(e.getHours(),2,"0")+":"+n(e.getMinutes(),2,"0")+":"+n(e.getSeconds(),2,"0")}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={link:location.href,ua:navigator.userAgent,title:document.title,size:document.documentElement.clientWidth+"*"+document.documentElement.clientHeight,referer:document.referer||"",timestamp:(new Date).getTime(),network:a(),badjs:S.BAD_JS,pid:e.pid},i=R(r,n),c=P[e.env]||"",u={ak:$,body:JSON.stringify({cmd:A,data:[{sid:"",op_type:"error",op_result:"",op_time:s(),op_object:"",op_page:"",op_params:R({platform:o(),in_app:w.jyb?1:0,cust_id:x,uniq_id:x||D,source:t("channel")||t("from")||"",act_id:"",group:""},i)}]})},d=[];for(var f in u)d.push(f+"="+encodeURIComponent(u[f]));e.debug?console.log(JSON.stringify(i,null,2)):l(c+"?"+d.join("&"))}function l(e){var n=i(),t=new Image;window[n]||(window[n]=t,t.onload=t.onerror=function(){window[n]=null,delete window[n]}),t.src=e}function d(e){var n=["msg","line","col","url","errStack"];return n.forEach(function(n){e[n]||(e[n]="")}),e.c1=[e.msg,e.line,e.col].join(","),e.c2=e.url,e.c3=e.errStack,n.forEach(function(n){return delete e[n]}),e}var f=window.navigator.userAgent,p=f.match(/(Android);?[\s\/]+([\d.]+)?/),h=f.match(/(iPad).*OS\s([\d_]+)/),m=f.match(/(iPod)(.*OS\s([\d_]+))?/),g=!h&&f.match(/(iPhone\sOS)\s([\d_]+)/),v=/jiayoubao/.test(f.toLowerCase()),w={};w.jyb=v,p&&(w.android=!0,w.version=p[2]),g&&!m&&(w.ios=w.iphone=!0,w.version=g[2].replace(/_/g,".")),h&&(w.ios=w.ipad=!0,w.version=h[2].replace(/_/g,".")),m&&(w.ios=w.ipod=!0,w.version=m[3]?m[3].replace(/_/g,"."):null);var y=[""," ","  ","   ","    ","     ","      ","       ","        ","         "],_=/\d\.\d{4}/,b="__TRACKER_UUID__",E="";a();var k={JS_ERROR:"1",API_ERROR:"2"},S={BAD_JS:"1"},j=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},O=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),R=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},P={test:"//172.16.1.16:8890",prod:"//report.jyblife.com"},$="KVQiUTJf",A="65010000",x=t("userid")||r("userid")||"",D=function(){try{var e=window.localStorage.getItem(b);return e||(e=i(),window.localStorage.setItem(b,e)),e}catch(e){return i()}}(),I=function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};j(this,n),this.$options=e,this.params=R({t_type:k.JS_ERROR},t),this._init()}return O(n,[{key:"_init",value:function(){var n=this;this.$options.collectWindowErrors&&e(this.$options,function(e){n._send(e)})}},{key:"_send",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this.$options,d(R({},this.params,e)))}},{key:"captureError",value:function(e,n){c(e)&&this._send(R({msg:(e.name||"")+": "+(e.message||""),errStack:(e.stack||"").toString()},n))}}]),n}(),J={pid:function(){var e=window.location.href,n=e.slice(e.indexOf("://")+3).split(/\/+/);return n.length>2?n[1]:""}(),debug:!1,collectWindowErrors:!0,env:"prod",commonParams:null},T=function(){function e(){j(this,e),this.$options={},this.commonParams={},this.inited=!1}return O(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.inited||(this.$options=R({},J,e),this.commonParams=this.$options.commonParams||{},this.initError(),this.inited=!0)}},{key:"log",value:function(e){if(!this.inited)throw new Error("必须先初始化");u(this.$options,R({},this.commonParams,e))}},{key:"captureApi",value:function(e){this.log(R({t_type:k.API_ERROR},e))}},{key:"initError",value:function(){var e=new I(this.$options,this.commonParams);this.error=e,this.Error=I,this.captureError=e.captureError.bind(e)}}]),e}(),C=new T;return C.Ctor=T,C});
