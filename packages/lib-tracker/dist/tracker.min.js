!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Tracker=t()}(this,function(){"use strict";function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=window.onerror;window.onerror=function(r,o,i,a,c){var u=Array.prototype.slice.call(arguments);if(n&&n.apply(window,u),"Script error."===r||o){a=a||window.event&&window.event.errorCharacter||0;var s="";if(c.stack)s=c.stack;else{for(var l=[],d=arguments.callee.caller,f=3;d&&--f>0&&(l.push(d.toString()),d!==d.caller);)d=d.caller;s=l.join("")}return t&&t({msg:r,url:o,line:i,col:a,errStack:s.toString()}),!e.debug}}}function t(e,t,n){if(e+="",(t-=e.length)<=0)return e;if(n||0===n||(n=" ")," "===(n+="")&&t<10)return y[t]+e;for(var r="";;){if(1&t&&(r+=n),!(t>>=1))break;n+=n}return r+e}function n(e){var t=arguments[1]||window.location.search.replace("&amp;","&"),n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),r=t.substr(t.indexOf("?")+1).match(n);return null!=r?r[2]:""}function r(e){var t=new RegExp("(^| )"+e+"(?:=([^;]*))?(;|$)"),n=document.cookie.match(t);return n?n[2]?unescape(n[2]):"":null}function o(){var e="";return m.android?e="android":m.ios&&(e="ios"),e}function i(e){return e=e||"g_tracker",String(Math.random()+Math.random()).replace(_,e)}function a(){return b||(m.jyb&&"undefined"!=typeof wv?wv.ready(function(){wv.getNetworkType({complete:function(e){b=e.networkType}})}):navigator.connection&&(b=navigator.connection.type||""),b||"")}function c(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}}function u(){var e=new Date;return e.getFullYear()+"-"+t(e.getMonth()+1,2,"0")+"-"+t(e.getDate(),2,"0")+" "+t(e.getHours(),2,"0")+":"+t(e.getMinutes(),2,"0")+":"+t(e.getSeconds(),2,"0")}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={link:location.href,ua:navigator.userAgent,title:document.title,size:document.documentElement.clientWidth+"*"+document.documentElement.clientHeight,referer:document.referer||"",timestamp:(new Date).getTime(),network:a(),badjs:S.BAD_JS,pid:e.pid},i=R(r,t),c=P[e.env]||"",s={ak:A,body:JSON.stringify({cmd:$,data:[{sid:"",op_type:"error",op_result:"",op_time:u(),op_object:"",op_page:"",op_params:R({platform:o(),in_app:m.jyb?1:0,cust_id:x,uniq_id:x||D,source:n("channel")||n("from")||"",act_id:"",group:""},i)}]})},d=[];for(var f in s)d.push(f+"="+encodeURIComponent(s[f]));e.debug?console.log(JSON.stringify(i,null,2)):l(c+"?"+d.join("&"))}function l(e){var t=i(),n=new Image;window[t]||(window[t]=n,n.onload=n.onerror=function(){window[t]=null,delete window[t]}),n.src=e}function d(e){var t=["msg","line","col","url","errStack"];return t.forEach(function(t){e[t]||(e[t]="")}),e.c1=[e.msg,e.line,e.col].join(","),e.c2=e.url,e.c3=e.errStack,t.forEach(function(t){return delete e[t]}),e}var f=window.navigator.userAgent,p=f.match(/(Android);?[\s\/]+([\d.]+)?/),h=f.match(/(iPad).*OS\s([\d_]+)/),g=f.match(/(iPod)(.*OS\s([\d_]+))?/),v=!h&&f.match(/(iPhone\sOS)\s([\d_]+)/),w=/jiayoubao/.test(f.toLowerCase()),m={};m.jyb=w,p&&(m.android=!0,m.version=p[2]),v&&!g&&(m.ios=m.iphone=!0,m.version=v[2].replace(/_/g,".")),h&&(m.ios=m.ipad=!0,m.version=h[2].replace(/_/g,".")),g&&(m.ios=m.ipod=!0,m.version=g[3]?g[3].replace(/_/g,"."):null);var y=[""," ","  ","   ","    ","     ","      ","       ","        ","         "],_=/\d\.\d{4}/,k="__TRACKER_UUID__",b="";a();var E={JS_ERROR:"1",API_ERROR:"2"},S={BAD_JS:"1"},j=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},O=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},P={test:"//172.16.1.16:8890",prod:"//report.jyblife.com"},A="KVQiUTJf",$="65010000",x=n("userid")||r("userid")||"",D=function(){try{var e=window.localStorage.getItem(k);return e||(e=i(),window.localStorage.setItem(k,e)),e}catch(e){return i()}}(),I=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};j(this,t),this.$options=e,this.params=R({t_type:E.JS_ERROR},n),this._init()}return O(t,[{key:"_init",value:function(){var t=this;this.$options.collectWindowErrors&&e(this.$options,function(e){t._send(e)})}},{key:"_send",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this.$options,d(R({},this.params,e)))}},{key:"captureError",value:function(e,t){c(e)&&this._send(R({msg:(e.name||"")+": "+(e.message||""),errStack:(e.stack||"").toString()},t))}}]),t}(),J={pid:function(){var e=window.location.href,t=e.slice(e.indexOf("://")+3).split(/\/+/);return t.length>2?t[1]:""}(),debug:!1,collectWindowErrors:!0,env:"prod"},T=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};j(this,e),this.$options=R({},J,t),this.trackParams={},this.initError()}return O(e,[{key:"setParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};R(this.trackParams,e)}},{key:"log",value:function(e){s(this.$options,R({},this.trackParams,e))}},{key:"captureApi",value:function(e){this.log(R({t_type:E.API_ERROR},e))}},{key:"initError",value:function(){var e=new I(this.$options,this.trackParams);this.error=e,this.Error=I,this.captureError=e.captureError.bind(e)}}]),e}(),C=new T((window.g_config||{}).tracker);return C.Ctor=T,C});
