!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Tracker=e()}(this,function(){"use strict";function r(t,e,n,i,o){return{msg:t,url:e=e||o&&o.fileName||"",line:n=n||o&&o.lineNumber||"",col:i=i||o&&o.columnNumber||"",stack:o&&o.stack||""}}var t,e,n,i,o,a,s,d=(t=window.navigator.userAgent,e=t.match(/(Android);?[\s\/]+([\d.]+)?/),n=t.match(/(iPad).*OS\s([\d_]+)/),i=t.match(/(iPod)(.*OS\s([\d_]+))?/),o=!n&&t.match(/(iPhone\sOS)\s([\d_]+)/),a=/jiayoubao/.test(t.toLowerCase()),(s={}).jyb=a,s.ie="ActiveXObject"in window,e&&(s.android=!0,s.version=e[2]),o&&!i&&(s.ios=s.iphone=!0,s.version=o[2].replace(/_/g,".")),n&&(s.ios=s.ipad=!0,s.version=n[2].replace(/_/g,".")),i&&(s.ios=s.ipod=!0,s.version=i[3]?i[3].replace(/_/g,"."):null),s),c=[""," ","  ","   ","    ","     ","      ","       ","        ","         "];function p(t,e,n){if((e-=(t+="").length)<=0)return t;if(n||0===n||(n=" ")," "===(n+="")&&e<10)return c[e]+t;for(var i="";1&e&&(i+=n),e>>=1;)n+=n;return i+t}var u=Object.prototype.toString,l=/\d\.\d{4}/,f="__TRACKER_UUID__",m="";function h(t){var e=arguments[1]||window.location.search.replace("&amp;","&"),n=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=e.substr(e.indexOf("?")+1).match(n);return null!=i?i[2]:""}function v(t){return t=t||"g_tracker",String(Math.random()+Math.random()).replace(l,t)}function w(){return m||(d.jyb&&"undefined"!=typeof wv?wv.ready(function(){wv.getNetworkType({complete:function(t){m=t.networkType}})}):navigator.connection&&(m=navigator.connection.type||""),m||"")}w();var g,y,_={JS_ERROR:"1",API_ERROR:"2",PERFORMANCE:"3"},E={BAD_JS:"1"},k=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},b=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),T=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},S={test:"//172.16.1.16:8890",prod:"//report.jyblife.com"},P="KVQiUTJf",j="65010000",O=h("userid")||(g=new RegExp("(^| )userid(?:=([^;]*))?(;|$)"),(y=document.cookie.match(g))?y[2]?unescape(y[2]):"":null)||"",R=function(){try{var t=window.localStorage.getItem(f);return t||(t=v(),window.localStorage.setItem(f,t)),t}catch(t){return v()}}();function $(){var t,e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o={link:location.href,ua:navigator.userAgent,title:document.title,size:document.documentElement.clientWidth+"*"+document.documentElement.clientHeight,referer:document.referer||"",timestamp:(new Date).getTime(),network:w(),badjs:E.BAD_JS,pid:n.pid},r=T(o,i),a=S[n.env]||"",s={ak:P,body:JSON.stringify({cmd:j,data:[{sid:"",op_type:"error",op_result:"",op_time:(e=new Date,e.getFullYear()+"-"+p(e.getMonth()+1,2,"0")+"-"+p(e.getDate(),2,"0")+" "+p(e.getHours(),2,"0")+":"+p(e.getMinutes(),2,"0")+":"+p(e.getSeconds(),2,"0")),op_object:"",op_page:"",op_params:T({platform:(t="",d.android?t="android":d.ios&&(t="ios"),t),in_app:d.jyb?1:0,cust_id:O,uniq_id:O||R,source:h("channel")||h("from")||"",act_id:"",group:""},r)}]})},c=[];for(var u in s)c.push(u+"="+encodeURIComponent(s[u]));n.debug?console.log(JSON.stringify(r,null,2)):function(t){var e=v(),n=new Image;window[e]||((window[e]=n).onload=n.onerror=function(){window[e]=null,delete window[e]});n.src=t}(a+"?"+c.join("&"))}var A=function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};k(this,n),this.$options=t,this.params=T({t_type:_.JS_ERROR},e),this._init()}return b(n,[{key:"_init",value:function(){var e=this;this.$options.collectWindowErrors&&function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1],o=window.onerror;window.onerror=function(){var t=Array.prototype.slice.call(arguments);o&&o.apply(window,t);var e=r.apply(window,t);return-1<e.msg.indexOf("Script error")&&!e.url?n.debug&&console.log(e.msg):i&&i(e),!1}}(this.$options,function(t){e._send(t)})}},{key:"_send",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};$(this.$options,this._paramsAdaptor(T({},this.params,t)))}},{key:"_paramsAdaptor",value:function(e){var t=["msg","line","col","url","stack"],n=this.$options;return t.forEach(function(t){e[t]||(e[t]="")}),e.c1=[e.msg,e.line,e.col].join(","),e.c2=e.url,e.c3=function(t,e){if(!t)return"";var n=t.toString(),i=n.split("\n");if(i.length>e)return i.slice(0,e).join("\n");return n}(e.stack,n.stackDepth),t.forEach(function(t){return delete e[t]}),e}},{key:"captureError",value:function(t,e){(function(t){switch(Object.prototype.toString.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return t instanceof Error}})(t)&&this._send(T(r((t.name||"")+": "+(t.message||""),"","","",t),e))}}]),n}();var x=function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};k(this,n),this.$options=t,this.params=T({t_type:_.API_ERROR},e),this._init()}return b(n,[{key:"captureApi",value:function(t){this._send(t,!1)}},{key:"_init",value:function(){this.$options.ajax&&this._ajaxHook(window.XMLHttpRequest)}},{key:"_send",value:function(){var e,t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=T({},this.params,n);i&&(e=o,(t=["method","url","body","time","statusCode","statusText","result"]).forEach(function(t){void 0===e[t]&&(e[t]="")}),e.c1=["method","url","body"].map(function(t){return t+":"+e[t]}).join(";"),e.c2=["time","statusCode","statusText"].map(function(t){return t+":"+e[t]}).join(";"),e.c3=e.result,t.forEach(function(t){return delete e[t]}),o=e),$(this.$options,o)}},{key:"_ajaxHook",value:function(t){var n=t.prototype.open,e=t.prototype.send,i=this;t.prototype.open=function(t,e){return this._apiTrackData={method:t.toLowerCase(),url:e},n.apply(this,arguments)},t.prototype.send=function(t){return this._apiTrackData.start=Date.now(),this._apiTrackData.body=t?JSON.stringify(t):"",i._addEvent(this),e.apply(this,arguments)}}},{key:"_addEvent",value:function(s){var c=this;s.addEventListener("readystatechange",function(){if(4===s.readyState){var t=s._apiTrackData,e=c.$options.apiCodeList,n=c.$options.apiReportFilter;if(!t)return;var i=Date.now()-t.start,o={method:t.method,url:t.url,body:t.body,time:i,statusCode:s.status,statusText:s.statusText},r=null,a=null;if(400<=s.status)a=T({result:""},o);else if(200===s.status)try{r=JSON.parse(s.responseText),(0===e.length&&void 0!==r.code&&0!==r.code&&"0"!==r.code||-1<e.indexOf(r.code))&&(a=T({result:(r.code||"")+", "+(r.msg||"")},o))}catch(t){}else i>c.$options.apiThreshold&&(a=T({result:""},o));a&&n(s,a)&&c._send(a)}},!0)}}]),n}();function D(){var t=window.performance||window.webkitPerformance||window.msPerformance||window.mozPerformance;if(void 0===t)return{};var e=t.timing,n={};if(e){if(void 0===n.firstPaint){var i=0;window.chrome&&window.chrome.loadTimes?(i=1e3*window.chrome.loadTimes().firstPaintTime,n.firstPaintTime=i-window.performance.timing.navigationStart):"number"==typeof window.performance.timing.msFirstPaint&&(i=window.performance.timing.msFirstPaint,n.firstPaintTime=i-window.performance.timing.navigationStart)}n.loadTime=e.loadEventEnd-e.fetchStart,n.domReadyTime=e.domComplete-e.domInteractive,n.readyStart=e.fetchStart-e.navigationStart,n.redirectTime=e.redirectEnd-e.redirectStart,n.appcacheTime=e.domainLookupStart-e.fetchStart,n.unloadEventTime=e.unloadEventEnd-e.unloadEventStart,n.lookupDomainTime=e.domainLookupEnd-e.domainLookupStart,n.connectTime=e.connectEnd-e.connectStart,n.requestTime=e.responseEnd-e.requestStart,n.initDomTreeTime=e.domInteractive-e.responseEnd,n.loadEventTime=e.loadEventEnd-e.loadEventStart}return n}var C=function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};k(this,n),this.$options=t,this.params=T({t_type:_.PERFORMANCE},e),this._init()}return b(n,[{key:"capturePerf",value:function(t){this._send({c2:L(t)})}},{key:"_init",value:function(){this.$options.perf&&this._addEvent()}},{key:"_addEvent",value:function(){var t=this;"complete"===document.readyState?setTimeout(function(){t._send({c1:L(D())})},0):window.addEventListener("load",function(){setTimeout(function(){t._send({c1:L(D())})},0)})}},{key:"_send",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};$(this.$options,T({},this.params,t))}}]),n}();function L(e){return t=e,"[object Object]"!==u.call(t)?"":Object.keys(e).map(function(t){return t+":"+e[t]}).join(";");var t}var N,I,J={pid:(N=window.location.href,I=N.slice(N.indexOf("://")+3).split(/\/+/),2<I.length?I[1]:""),debug:!1,ajax:!1,perf:!1,apiThreshold:3e3,apiCodeList:[],apiReportFilter:function(){return!0},collectWindowErrors:!0,stackDepth:8,env:"prod",commonParams:null},M=function(){function t(){k(this,t),this.$options={},this.commonParams={},this.inited=!1}return b(t,[{key:"init",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.inited||(this.$options=T({},J,t),this.commonParams=this.$options.commonParams||{},this.initError(),this.initApi(),this.initPerf(),this.inited=!0)}},{key:"log",value:function(t){if(!this.inited)throw new Error("必须先初始化");$(this.$options,T({},this.commonParams,t))}},{key:"initApi",value:function(){var t=new x(this.$options,this.commonParams);this.api=t,this.Api=t,this.captureApi=t.captureApi.bind(t)}},{key:"initError",value:function(){var t=new A(this.$options,this.commonParams);this.error=t,this.Error=A,this.captureError=t.captureError.bind(t)}},{key:"initPerf",value:function(){var t=new C(this.$options,this.commonParams);this.perf=t,this.Perf=C,this.capturePerf=t.capturePerf.bind(t)}}]),t}(),F=new M;return F.Ctor=M,F});
