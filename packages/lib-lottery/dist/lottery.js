!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):i.Lottery=t()}(this,function(){"use strict";var i=function(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),e=Object.assign||function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},s={maxGrid:8,times:30,prizeIndex:0,speed:200,gridClass:"",callback:function(){},activeClass:"active",reduce:10,advanceTimes:10,continueTimes:20};return function(){function n(t){i(this,n),this.config=e(s,t),this.gridList=[],this.index=0,this.isStop=!1,this.prt=null,this.currentGrid=null,this.loopedTimes=0,this.isLastStep=!1,this._init()}return t(n,[{key:"_init",value:function(){if(this.config.prizeIndex<0||this.config.prizeIndex>this.config.maxGrid)throw new Error("奖品序号不在允许范围内");for(var i=1;i<=this.config.maxGrid;i++){var t=document.querySelector("."+this.config.gridClass+"[index='"+i+"']");t&&this.gridList.push(t)}this._start()}},{key:"_start",value:function(){var i=this;this.isStop?this._clearStatus():(++this.index>this.config.maxGrid&&(this.index=1),this.ptr=setTimeout(function(){i._doLoop()},this.config.speed))}},{key:"setPrizeIndex",value:function(i){if(i<1||i>this.config.maxGrid)throw this.isStop=!0,new Error("奖品序号不在允许范围内");return this.config.prizeIndex=i,this.config.times+=this.config.continueTimes,this}},{key:"setTimes",value:function(i){if(i<0)throw new Error("高亮格子数量不能小于0");return this.config.times=i,this}},{key:"stop",value:function(){return this.isStop=!0,clearTimeout(this.ptr),this}},{key:"_doLoop",value:function(){if(this.currentGrid&&this.currentGrid.classList.remove(this.config.activeClass),this.currentGrid=this.gridList[this.index-1],this.currentGrid.classList.add(this.config.activeClass),++this.loopedTimes>=this.config.times&&!this.config.prizeIndex)return this.config.times+=this.config.continueTimes,void this._start();if(this.config.prizeIndex&&(this.isLastStep||this.loopedTimes+this.config.advanceTimes>this.config.times)&&(this.config.speed+=this.config.reduce),this.loopedTimes>=this.config.times){var i=0;if(0===(i=this.index<this.config.prizeIndex?this.config.prizeIndex-this.index:this.index==this.config.prizeIndex?0:this.config.maxGrid-this.index+this.config.prizeIndex))return this.config.callback(this.currentGrid),void clearTimeout(this.ptr);this.isLastStep=!0,this.config.times+=i,this._start()}else this._start()}},{key:"_clearStatus",value:function(){this.currentGrid.classList.remove(this.config.activeClass)}}]),n}()});
