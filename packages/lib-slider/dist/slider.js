!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Slider=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},n={domWrap:"",auto:!1,element:"li",topDocMove:!0,animateNode:"ul",loop:!0,rightLimit:"",width:window.innerWidth,preLoad:!1,lazyLoad:!1,animateTime:500,fingerFollow:!0,lazyAttr:"data-lazy",initIndex:0,autoTime:5e3,onClick:function(){},onInit:function(){},onLeft:function(){},onRight:function(){},onComplete:function(){}};return function(){function o(e){if(t(this,o),this.width=window.innerWidth,this.option=i({},n,e),!this.option.domWrap)throw new Error("轮播容器不能为空");this._initEL()}return e(o,[{key:"_initEL",value:function(){var t=this,e=t.option;return this.animateNode=e.domWrap.querySelector(e.animateNode),this.domList=e.domWrap.querySelectorAll(e.element),this.scrollLength=e.rightLimit?e.rightLimit/e.width:this.domList.length,this.isLoop=e.loop&&this.scrollLength>2,[].forEach.call(this.domList,function(i,n){i.style.cssText="left:"+(t.isLoop&&n===t.scrollLength-1?-e.width:n*e.width)+"px;width:"+e.width+"px"}),this.position={},this.currentPosition=e.width*e.initIndex,this.currentIndex=e.initIndex,this.lastIndex=0,this.nextIndex=0,this._doAnimate(this.currentPosition,!0)._animateEnd(),this.option.onInit.call(this,this.domWrap,this.currentIndex),this._initEvent(),this}},{key:"_initEvent",value:function(){this.option.auto&&this._startAuto(),this._bindEvent()}},{key:"_setELPosition",value:function(){if(this.lastIndex!==this.currentIndex){var t=this.lastIndex>this.currentIndex,e=this.currentIndex,i=this.scrollLength;return t?(e<=0?(0===this.nextIndex&&(this.nextIndex=this.scrollLength-1),this.nextIndex=e%i==0?i-1:Math.abs(this.nextIndex-1)):(e%i==0&&(this.nextIndex=0),this.nextIndex=(e-1)%i==0?0:0===e?i-1:Math.abs((e-1)%i)),this.domList[this.nextIndex].style.left=(e-1)*this.width+"px"):(this.nextIndex=(e+1)%i==0?0:(e+1)%i,this.domList[this.nextIndex].style.left=(e+1)*this.width+"px"),this.lastIndex=this.currentIndex,this}}},{key:"_bindEvent",value:function(){var t=this.option.domWrap;return t.addEventListener("touchstart",this._handleEvent.bind(this)),t.addEventListener("touchmove",this._handleEvent.bind(this)),t.addEventListener("touchend",this._handleEvent.bind(this)),this.animateNode.addEventListener("webkitTransitionEnd",this._animateEnd.bind(this)),this}},{key:"_handleEvent",value:function(t){switch(t.type){case"touchstart":this._start(t);break;case"touchmove":this._move(t);break;case"touchend":this._end(t)}}},{key:"_animateEnd",value:function(){return this.option.onComplete.call(this,this.option.domWrap,this.currentIndex,this.scrollLength),this.isLoop&&this._setELPosition(),this.option.auto&&this._startAuto(),this.option.lazyLoad&&(this._loadImage(),this.option.preLoad&&this._loadImage(this.getCurrentIndex()+1)),this.scrollLock=!1,this}},{key:"_doAnimate",value:function(t,e){var i=e?0:this.option.animateTime;return this.animateNode.style.webkitTransform="translate3d("+t+"px, 0, 0)",this.animateNode.style.webkitTransitionDuration=i+"ms",this}},{key:"_stopDocument",value:function(t){t.preventDefault()}},{key:"_start",value:function(t){if(!this.scrollLock){var e=t.changedTouches[0];this.position.sx=e.pageX,this.position.sy=e.pageY,this.scrollLock=!0,this.stopAuto(),this.option.topDocMove&&document.addEventListener("touchmove",this._stopDocument,!1)}}},{key:"_move",value:function(t){if(this.option.fingerFollow&&this.position.sx){var e=t.changedTouches[0],i=e.pageX,n=e.pageY,o=i-this.position.sx;Math.abs(n-this.position.sy)>50||Math.abs(o)>20&&(t.preventDefault(),this.animateNode.style.webkitTransform="translate3d("+(this.currentPosition+o)+"px, 0, 0)",this.animateNode.style.webkitTransitionDuration="0ms")}}},{key:"_end",value:function(t){if(this.position.sx){this.option.topDocMove&&document.removeEventListener("touchmove",this._stopDocument,!1);var e=t.changedTouches[0],i=e.pageX,n=e.pageY;this.position.ex=i;var o=this.position.ex-this.position.sx;if(0===o)return this.option.onClick.call(this),void(this.position={});var s=this.position.sy-n;Math.abs(s)>50?this._doAnimate(-this.currentIndex*this.width,!1):Math.abs(o)<this.width/4?this._doAnimate(-this.currentIndex*this.width):(this.lastIndex=this.currentIndex,o<0?(this.currentIndex++,this.option.onLeft.call(this,this.currentIndex)):(this.currentIndex--,this.option.onRight.call(this,this.currentIndex)),this.isLoop||(this.currentIndex<0?this.currentIndex=0:this.currentIndex=this.currentIndex>=this.scrollLength-1?this.scrollLength-1:this.currentIndex),this.toNext()),this.position={}}else this.scrollLock=!1}},{key:"_loadImage",value:function(t){t=t||this.getCurrentIndex();var e=this.domList[t];if(e&&!e.getAttribute("loaded")){var i=e.querySelector("img"),n=i.getAttribute(this.option.lazyAttr);i.setAttribute("src",n),i.removeAttribute(this.option.lazyAttr),e.setAttribute("loaded",1)}}},{key:"_startAuto",value:function(){var t=this;clearTimeout(t.autoPtr),this.autoPtr=setTimeout(function(){t.autoLock||(t.isLoop?t.currentIndex++:(t.currentIndex===t.scrollLength-1?t.reverse=!0:0===t.currentIndex&&(t.reverse=!1),t.reverse?t.currentIndex--:t.currentIndex++),t.toNext())},this.option.autoTime)}},{key:"toNext",value:function(t){return void 0!==t&&(t=t<0?0:t>=this.scrollLength-1?this.scrollLength-1:t,this.lastIndex=this.currentIndex,this.currentIndex=t),this.currentPosition=-this.currentIndex*this.width,this._doAnimate(this.currentPosition),this}},{key:"stopAuto",value:function(){clearTimeout(this.autoPtr),this.autoPtr=null,this.reverse=!1}},{key:"stopAutoThorough",value:function(){clearTimeout(this.autoPtr),this.autoPtr=null,this.reverse=!1,this.option.auto=!1}},{key:"getCurrentIndex",value:function(){var t=this.currentIndex,e=Math.ceil(Math.abs(t/this.scrollLength));return Math.abs(t<0?(e*this.scrollLength+t)%this.scrollLength:t%this.scrollLength)}},{key:"destroy",value:function(){var t=this.option.domWrap;return t.removeEventListener("touchstart",this._handleEvent.bind(this)),t.removeEventListener("touchmove",this._handleEvent.bind(this)),t.removeEventListener("touchend",this._handleEvent.bind(this)),this.animateNode.removeEventListener("webkitTransitionEnd",this._animateEnd.bind(this)),this.stopAuto(),this}},{key:"updateEL",value:function(){this.destroy()._initEL()}},{key:"reverse",value:function(){this._bindEvent()._animateEnd()}}]),o}()});
